ä»¥ä¸‹æ˜¯ä¸€ä»½å®Œæ•´çš„ **å†…ç½‘éƒ¨ç½² Dify çš„æŠ€æœ¯æ–‡æ¡£ / README**ï¼Œå¯ç›´æ¥ç”¨äºå½’æ¡£æˆ–å›¢é˜Ÿä½¿ç”¨è¯´æ˜ã€‚

---

## ğŸ“˜ å†…ç½‘éƒ¨ç½² Dify å¹³å°æŠ€æœ¯æ–‡æ¡£

> æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨æ— å…¬ç½‘è®¿é—®çš„å†…ç½‘ç¯å¢ƒä¸‹ï¼Œé€šè¿‡é…ç½®ä»£ç†ä¸å…¬å…± DNSï¼ŒæˆåŠŸéƒ¨ç½² Dify å¼€æºå¤§æ¨¡å‹åº”ç”¨å¹³å°ã€‚

---

### ğŸ“¦ ä¸€ã€é¡¹ç›®ç®€ä»‹

[Dify](https://github.com/langgenius/dify) æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ¨¡å‹ï¼ˆå¦‚ OpenAIã€Qwenã€Baichuanã€Geminiã€æœ¬åœ°éƒ¨ç½²æ¨¡å‹ç­‰ï¼‰çš„å¼€æº LLM åº”ç”¨å¼€å‘å¹³å°ï¼Œæ”¯æŒçŸ¥è¯†åº“ã€æ’ä»¶è°ƒç”¨ã€Agent æµç¨‹ã€å¤šè½®å¯¹è¯ç­‰åŠŸèƒ½ã€‚

---

### ğŸ§© äºŒã€éƒ¨ç½²ç›®æ ‡

* å†…ç½‘éƒ¨ç½²ï¼ˆæ— å…¬ç½‘ IPï¼‰
* å¯è®¿é—®å…¬ç½‘æ¨¡å‹ APIï¼ˆé€šè¿‡ä»£ç†ï¼‰
* æ­£ç¡®è§£æå¤–éƒ¨ DNSï¼ˆå¦‚ `api.openai.com`ï¼‰

---

### ğŸ›  ä¸‰ã€ç¯å¢ƒå‡†å¤‡

#### âœ… ç³»ç»Ÿä¾èµ–

| é¡¹ç›®             | è¯´æ˜                      |
| -------------- | ----------------------- |
| OS             | Linux / CentOS / Ubuntu |
| Docker         | â‰¥ 20.10                 |
| Docker Compose | â‰¥ 2.0                   |
| Git            | æ‹‰å–é¡¹ç›®æºç                   |

---

### ğŸ” å››ã€ä»£ç†é…ç½®ï¼ˆCNTLMï¼‰

è‹¥å†…ç½‘åªèƒ½é€šè¿‡ HTTP ä»£ç†è®¿é—®å…¬ç½‘ï¼ˆå¦‚ CNTLM ä»£ç†ï¼‰ï¼Œéœ€è®¾ç½®å¦‚ä¸‹ï¼š

#### 1. CNTLM æœ¬åœ°ä»£ç†å®‰è£…

å‚è€ƒ CNTLM å®˜æ–¹æ–‡æ¡£æˆ–ç³»ç»ŸåŒ…å®‰è£…ï¼š

```bash
# Debian / Ubuntu
sudo apt install cntlm

# CentOS / RHEL
sudo yum install cntlm
```

#### 2. éªŒè¯ CNTLM å·¥ä½œæ­£å¸¸

```bash
curl -x http://localhost:3128 http://www.google.com
```

#### 3. è·å– `cntlm` ä»£ç†åœ°å€

ä¾‹å¦‚ï¼š

```bash
http://172.30.1.10:3128
```

---

### ğŸ“ äº”ã€é¡¹ç›®æ‹‰å–ä¸ç›®å½•ç»“æ„

```bash
git clone https://github.com/langgenius/dify.git
cd dify
```

å…³é”®æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š

```text
dify/
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ .env                  # ä¸»é…ç½®æ–‡ä»¶ï¼ˆéœ€è‡ªå®šä¹‰ï¼‰
â”œâ”€â”€ .env.middleware       # ä¸­é—´ä»¶é…ç½®æ–‡ä»¶ï¼ˆéœ€è‡ªå®šä¹‰ï¼‰
â”œâ”€â”€ frontend/             # å‰ç«¯åº”ç”¨
â”œâ”€â”€ backend/              # åç«¯æœåŠ¡
```

---

### âš™ï¸ å…­ã€ç¯å¢ƒå˜é‡é…ç½®ï¼ˆé‡ç‚¹ï¼‰

#### 1. ä¿®æ”¹ `.env` æ–‡ä»¶

```env
# === HTTP ä»£ç†é…ç½® ===
HTTP_PROXY=http://172.30.1.10:3128
HTTPS_PROXY=http://172.30.1.10:3128
NO_PROXY=localhost,127.0.0.1,dify-db,redis,dify-api,dify-web,dify-worker

# === DNS é…ç½®ï¼ˆéƒ¨åˆ†å®¹å™¨æ— æ³•è§£æå†…ç½‘ DNS æ—¶ï¼‰===
DNS=8.8.8.8,114.114.114.114,10.54.12.44,10.187.50.203

# === æ¨¡å‹ API é…ç½®ï¼ˆç¤ºä¾‹ï¼šOpenAIï¼‰===
OPENAI_API_KEY=sk-xxxx
OPENAI_API_BASE=https://api.openai.com/v1
```

> âš ï¸ æ³¨æ„ `NO_PROXY` ä¸€å®šè¦åŒ…å«å†…éƒ¨æœåŠ¡çš„å®¹å™¨åï¼Œå¦åˆ™ä¼šå› ä¸ºä»£ç†åè€Œè®¿é—®ä¸äº†æœåŠ¡æœ¬ä½“ã€‚

---

#### 2. ä¿®æ”¹ `.env.middleware` æ–‡ä»¶ï¼ˆæˆ– middleware.envï¼‰

```env
HTTP_PROXY=http://172.30.1.10:3128
HTTPS_PROXY=http://172.30.1.10:3128
NO_PROXY=localhost,127.0.0.1,mysql,redis,mongo,rabbitmq
```

ç”¨äº Redisã€Mongoã€MySQL ç­‰ä¸­é—´ä»¶å®¹å™¨ã€‚

---

#### 3. ä¿®æ”¹ `docker-compose.yaml` å¢åŠ  DNS é…ç½®

```yaml
services:
  dify-api:
    ...
    dns:
      - 8.8.8.8
      - 114.114.114.114
```

ä½ å¯ä»¥å°† `dns:` é…ç½®åŠ åˆ°æ‰€æœ‰æœåŠ¡ä¸­ï¼Œæˆ–åœ¨ `docker-compose.yml` é¡¶éƒ¨å…¨å±€æŒ‡å®šï¼š

```yaml
x-common-dns: &common-dns
  dns:
    - 8.8.8.8
    - 114.114.114.114
    - 10.54.12.44

services:
  dify-api:
    <<: *common-dns
    ...
```

---

### ğŸš€ ä¸ƒã€å¯åŠ¨æœåŠ¡

```bash
docker-compose up -d
```

---

### âœ… å…«ã€è®¿é—®æœåŠ¡

* æ ¹æ®ä½ éƒ¨ç½²æ—¶æš´éœ²çš„ç«¯å£è®¿é—®/install

---

### ğŸ§ª ä¹ã€å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜                  | è§£å†³æ–¹æ¡ˆ                             |
| ------------------- | -------------------------------- |
| `DNS resolve error` | æ·»åŠ  DNS é…ç½®ï¼Œä¼˜å…ˆè§£æ 8.8.8.8           |
| `API 404`           | æ¨¡å‹ URL è®¾ç½®é”™è¯¯ï¼Œæ£€æŸ¥ `OPENAI_API_BASE` |
| æ— æ³•è®¿é—®å…¬ç½‘              | æ£€æŸ¥ CNTLM æ˜¯å¦é…ç½®æˆåŠŸ                  |
| æ¨¡å‹éªŒè¯å¤±è´¥              | ä»£ç†å¯èƒ½æ— æ³•è®¿é—®å¤–éƒ¨æ¨¡å‹æœåŠ¡                   |

---

### ğŸ§  åã€å»ºè®®

* æ¨èä½¿ç”¨ CNTLM + docker-compose å…¨é¢ä»£ç†æµé‡
* æ’ä»¶è°ƒç”¨éœ€ç¡®ä¿ç›®æ ‡ API å¯åœ¨å†…ç½‘ä¸­è®¿é—®
* å¯éƒ¨ç½²ç§æœ‰æ¨¡å‹ï¼ˆå¦‚ Qwenï¼‰ä»¥é¿å…è®¿é—®å¤–ç½‘
* å»ºè®®å°† `.env`ã€`middleware.env` åŠ å…¥ `.gitignore`ï¼Œé¿å…æ³„éœ²ä»£ç†ä¿¡æ¯

---




